import{p as U,e as T,f,B as V,j,u as L,g as E,E as A,c,o as r,a as e,t as h,z as _,A as x,G as B,b as S,d as N,F as R,h as F}from"./index-C69pFwWw.js";import{M as G,_ as z}from"./DeleteModal.vue_vue_type_script_setup_true_lang-C3CdSstr.js";import{L as H}from"./LayoutPagination-BnxaVBOU.js";function I(){return document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1")}const q="https://ec-course-api.hexschool.io/",v=U.create({baseURL:q});v.interceptors.request.use(n=>{const i=I();return i&&(n.headers.Authorization=i),n},n=>Promise.reject(n));v.interceptors.response.use(n=>n,n=>Promise.reject(n.response.data));const M="yameow2025",W=n=>v.post(`/v2/api/${M}/admin/coupon`,{data:n}),Y=n=>{const{id:i,data:b}=n;return v.put(`/v2/api/${M}/admin/coupon/${i}`,{data:b})},J=n=>v.delete(`/v2/api/${M}/admin/coupon/${n}`),K=n=>v.get(`/v2/api/${M}/admin/coupons`,{params:n}),O={class:"modal-dialog modal-dialog-centered modal-lg"},Q={class:"modal-content rounded-lg"},X={class:"modal-header"},Z={class:"modal-title",id:"couponModalLabel"},ee={class:"modal-body"},te={class:"mb-3"},oe={class:"mb-3"},ne={class:"mb-3"},ae={class:"mb-3"},le={class:"mb-3 d-flex align-items-center"},se={class:"form-check form-switch"},de={class:"modal-footer"},ie=T({__name:"CouponModal",props:{coupon:{},functionMode:{}},emits:["get-coupons"],setup(n,{expose:i,emit:b}){const u=n,a=f(u.coupon),p=V({get(){if(!a.value.due_date)return"";const l=new Date(a.value.due_date),t=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),s=String(l.getDate()).padStart(2,"0");return`${t}-${o}-${s}`},set(l){if(!l){a.value.due_date=Date.now();return}const[t,o,s]=l.split("-").map(Number),y=new Date(t,o-1,s,0,0,0,0);a.value.due_date=y.getTime()}});j([()=>u.coupon,()=>u.functionMode],([l])=>{a.value={...l}});const w=b;let d=null;const m=L("modalRef"),D=()=>{d&&d.show()},k=()=>{d&&d.hide()};E(()=>{m.value&&(d=new G(m.value))}),A(()=>{d&&d.dispose()}),i({openModal:D,closeModal:k});const g=async l=>{try{const t=await W(l)}catch{alert("新增優惠券失敗，請稍後再試")}},$=async()=>{try{const{id:l,title:t,is_enabled:o,percent:s,due_date:y,code:P}=a.value,ke=await Y({id:l,data:{title:t,is_enabled:o,percent:s,due_date:y,code:P}})}catch{alert("更新優惠券失敗，請稍後再試")}},C=async l=>{l==="create"?await g(a.value):await $(),k(),w("get-coupons")};return(l,t)=>(r(),c("div",{ref_key:"modalRef",ref:m,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",O,[e("div",Q,[e("div",X,[e("h5",Z,h(u.functionMode==="create"?"新增優惠券":"編輯優惠券"),1),t[7]||(t[7]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ee,[e("form",null,[e("div",te,[t[8]||(t[8]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),_(e("input",{type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣","onUpdate:modelValue":t[0]||(t[0]=o=>a.value.title=o)},null,512),[[x,a.value.title]])]),e("div",oe,[t[9]||(t[9]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),_(e("input",{type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024","onUpdate:modelValue":t[1]||(t[1]=o=>a.value.code=o)},null,512),[[x,a.value.code]])]),e("div",ne,[t[10]||(t[10]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),_(e("input",{type:"number",max:"100",min:"0",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折","onUpdate:modelValue":t[2]||(t[2]=o=>a.value.percent=o)},null,512),[[x,a.value.percent]])]),e("div",ae,[t[11]||(t[11]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),_(e("input",{type:"date",class:"form-control rounded-lg",id:"couponEndDate","onUpdate:modelValue":t[3]||(t[3]=o=>p.value=o)},null,512),[[x,p.value]])]),e("div",le,[t[12]||(t[12]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",se,[_(e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable","onUpdate:modelValue":t[4]||(t[4]=o=>a.value.is_enabled=o),"true-value":1,"false-value":0},null,512),[[B,a.value.is_enabled]])])])])]),e("div",de,[t[13]||(t[13]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),u.functionMode==="create"?(r(),c("button",{key:0,type:"button",class:"btn btn-dark rounded-lg",onClick:t[5]||(t[5]=o=>C("create"))}," 新增 ")):(r(),c("button",{key:1,type:"button",class:"btn btn-dark rounded-lg",onClick:t[6]||(t[6]=o=>C("edit"))}," 儲存 "))])])])],512))}}),ue={class:"d-flex justify-content-end align-items-center mb-4"},ce={class:"card shadow-sm rounded-lg flex-grow-1"},re={class:"card-body p-4"},pe={key:0,class:"table-responsive"},me={class:"table table-hover align-middle"},fe={class:"text-center"},be={class:"form-check form-switch d-flex justify-content-center align-items-center"},ve=["checked"],ge={class:"text-nowrap"},ye=["onClick"],_e=["onClick"],he={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"calc(100vh - 98px)"}},Me=T({__name:"CouponManagement",setup(n){const i=f([]),b=f("1"),u=f({total_pages:0,current_page:0,has_pre:!1,has_next:!1,category:""}),a=f(!1),p=async()=>{a.value=!0;try{const t=await K({page:b.value});i.value=t.data.coupons,u.value=t.data.pagination}catch{alert("取得優惠券失敗，請稍後再試")}finally{a.value=!1}},w=t=>{b.value=t,p()};E(()=>{p()});const d=()=>({id:"",title:"",is_enabled:0,percent:0,due_date:new Date().getTime()+3600*24*1e3,code:"",num:0}),m=f(d()),D=L("couponModalRef"),k=L("couponDeleteModalRef"),g=f("create"),$=(t=null)=>{t?(m.value={...t},g.value="edit"):(m.value=d(),g.value="create"),D.value?.openModal()},C=t=>{k.value?.openModal(()=>l(t))},l=async t=>{try{await J(t)}catch{alert("刪除失敗，請稍後再試")}finally{p()}};return(t,o)=>(r(),c(R,null,[e("div",ue,[e("button",{type:"button",class:"btn btn-dark rounded-lg px-4 py-2",onClick:o[0]||(o[0]=s=>$(null))},[...o[1]||(o[1]=[e("i",{class:"fas fa-plus me-2"},null,-1),N("新增優惠券 ",-1)])])]),e("div",ce,[e("div",re,[a.value?(r(),c("div",he,[...o[3]||(o[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):(r(),c("div",pe,[e("table",me,[o[2]||(o[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠券碼"),e("th",{scope:"col"},"優惠折扣"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(r(!0),c(R,null,F(i.value,s=>(r(),c("tr",{key:s.id},[e("td",null,h(s.title),1),e("td",null,h(s.code),1),e("td",null,h(`${s.percent}%`),1),e("td",null,h(new Date(s.due_date).toLocaleDateString()),1),e("td",fe,[e("div",be,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!s.is_enabled},null,8,ve)])]),e("td",ge,[e("button",{type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2",onClick:y=>$(s)}," 編輯 ",8,ye),e("button",{type:"button",class:"btn btn-sm btn-outline-danger rounded-lg",onClick:y=>C(s.id)}," 刪除 ",8,_e)])]))),128))])])]))]),S(H,{pagination:u.value,onHandlePagination:w},null,8,["pagination"])]),S(ie,{ref:"couponModalRef",coupon:m.value,"function-mode":g.value,onGetCoupons:p},null,8,["coupon","function-mode"]),S(z,{ref:"couponDeleteModalRef",title:"刪除優惠券",content:"確定要刪除優惠券嗎？"},null,512)],64))}});export{Me as default};
