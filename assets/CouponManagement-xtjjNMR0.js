import{a as j,d as L,r as f,c as A,w as B,u as S,o as U,b as N,e as u,f as r,g as e,t as $,i as k,v as C,j as P,q as R,m as F,F as T,n as q}from"./index-XN3irxbr.js";import{M as G,_ as I}from"./DeleteModal.vue_vue_type_script_setup_true_lang-CecN5qkB.js";function z(){return document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1")}const H="https://ec-course-api.hexschool.io/",b=j.create({baseURL:H});b.interceptors.request.use(n=>{const d=z();return d&&(n.headers.Authorization=d),n},n=>Promise.reject(n));b.interceptors.response.use(n=>n,n=>Promise.reject(n.response.data));const x="yameow2025",W=n=>b.post(`/v2/api/${x}/admin/coupon`,{data:n}),Y=n=>{const{id:d,data:v}=n;return b.put(`/v2/api/${x}/admin/coupon/${d}`,{data:v})},J=n=>b.delete(`/v2/api/${x}/admin/coupon/${n}`),K=n=>b.get(`/v2/api/${x}/admin/coupons`,{params:n}),O={class:"modal-dialog modal-dialog-centered modal-lg"},Q={class:"modal-content rounded-lg"},X={class:"modal-header"},Z={class:"modal-title",id:"couponModalLabel"},ee={class:"modal-body"},oe={class:"mb-3"},te={class:"mb-3"},ne={class:"mb-3"},le={class:"mb-3"},se={class:"mb-3 d-flex align-items-center"},ae={class:"form-check form-switch"},de={class:"modal-footer"},ce=L({__name:"CouponModal",props:{coupon:{},functionMode:{}},emits:["get-coupons"],setup(n,{expose:d,emit:v}){const c=n,l=f(c.coupon),g=A({get(){if(!l.value.due_date)return"";const t=new Date(l.value.due_date),o=t.getFullYear(),s=String(t.getMonth()+1).padStart(2,"0"),h=String(t.getDate()).padStart(2,"0");return`${o}-${s}-${h}`},set(t){if(!t){l.value.due_date=Date.now();return}const[o,s,h]=t.split("-").map(Number),D=new Date(o,s-1,h,0,0,0,0);l.value.due_date=D.getTime()}});B([()=>c.coupon,()=>c.functionMode],([t])=>{l.value={...t}});const p=v;let i=null;const y=S("modalRef"),m=()=>{i&&i.show()},_=()=>{i&&i.hide()};U(()=>{y.value&&(i=new G(y.value))}),N(()=>{i&&i.dispose()}),d({openModal:m,closeModal:_});const M=async t=>{try{const o=await W(t);console.log("新增優惠券成功",o)}catch(o){console.error(o),alert("新增優惠券失敗，請稍後再試")}},w=async()=>{try{const{id:t,title:o,is_enabled:s,percent:h,due_date:D,code:V}=l.value,E=await Y({id:t,data:{title:o,is_enabled:s,percent:h,due_date:D,code:V}});console.log("更新優惠券成功",E)}catch(t){console.error(t),alert("更新優惠券失敗，請稍後再試")}},a=async t=>{t==="create"?await M(l.value):await w(),_(),p("get-coupons")};return(t,o)=>(r(),u("div",{ref_key:"modalRef",ref:y,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",O,[e("div",Q,[e("div",X,[e("h5",Z,$(c.functionMode==="create"?"新增優惠券":"編輯優惠券"),1),o[7]||(o[7]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",ee,[e("form",null,[e("div",oe,[o[8]||(o[8]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),k(e("input",{type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣","onUpdate:modelValue":o[0]||(o[0]=s=>l.value.title=s)},null,512),[[C,l.value.title]])]),e("div",te,[o[9]||(o[9]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),k(e("input",{type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024","onUpdate:modelValue":o[1]||(o[1]=s=>l.value.code=s)},null,512),[[C,l.value.code]])]),e("div",ne,[o[10]||(o[10]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),k(e("input",{type:"number",max:"100",min:"0",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折","onUpdate:modelValue":o[2]||(o[2]=s=>l.value.percent=s)},null,512),[[C,l.value.percent]])]),e("div",le,[o[11]||(o[11]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),k(e("input",{type:"date",class:"form-control rounded-lg",id:"couponEndDate","onUpdate:modelValue":o[3]||(o[3]=s=>g.value=s)},null,512),[[C,g.value]])]),e("div",se,[o[12]||(o[12]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",ae,[k(e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable","onUpdate:modelValue":o[4]||(o[4]=s=>l.value.is_enabled=s),"true-value":1,"false-value":0},null,512),[[P,l.value.is_enabled]])])])])]),e("div",de,[o[13]||(o[13]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),c.functionMode==="create"?(r(),u("button",{key:0,type:"button",class:"btn btn-dark rounded-lg",onClick:o[5]||(o[5]=s=>a("create"))}," 新增 ")):(r(),u("button",{key:1,type:"button",class:"btn btn-dark rounded-lg",onClick:o[6]||(o[6]=s=>a("edit"))}," 儲存 "))])])])],512))}}),ie={class:"d-flex justify-content-end align-items-center mb-4"},ue={class:"card shadow-sm rounded-lg flex-grow-1"},re={class:"card-body p-4"},pe={key:0,class:"table-responsive"},me={class:"table table-hover align-middle"},fe={class:"text-center"},be={class:"form-check form-switch d-flex justify-content-center align-items-center"},ve=["checked"],ge={class:"text-nowrap"},ye=["onClick"],_e=["onClick"],he={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"calc(100vh - 98px)"}},Ce=L({__name:"CouponManagement",setup(n){const d=f([]),v=f("1"),c=f(!1),l=async()=>{c.value=!0;try{const a=await K({page:v.value});console.log("取得優惠券成功",a),d.value=a.data.coupons}catch(a){console.error(a),alert("取得優惠券失敗，請稍後再試")}finally{c.value=!1}};U(()=>{l()});const g=()=>({id:"",title:"",is_enabled:0,percent:0,due_date:new Date().getTime()+3600*24*1e3,code:"",num:0}),p=f(g()),i=S("couponModalRef"),y=S("couponDeleteModalRef"),m=f("create"),_=(a=null)=>{a?(p.value={...a},m.value="edit"):(p.value=g(),m.value="create"),console.log("應該要傳入的 coupon 資料",p.value),console.log("應該要傳入的 mode",m.value),i.value?.openModal()},M=a=>{y.value?.openModal(()=>w(a))},w=async a=>{try{await J(a)}catch(t){console.error(t),alert("刪除失敗，請稍後再試")}finally{l()}};return(a,t)=>(r(),u(T,null,[e("div",ie,[e("button",{type:"button",class:"btn btn-dark rounded-lg px-4 py-2",onClick:t[0]||(t[0]=o=>_(null))},[...t[1]||(t[1]=[e("i",{class:"fas fa-plus me-2"},null,-1),F("新增優惠券 ",-1)])])]),e("div",ue,[e("div",re,[c.value?(r(),u("div",he,[...t[3]||(t[3]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):(r(),u("div",pe,[e("table",me,[t[2]||(t[2]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠券碼"),e("th",{scope:"col"},"優惠折扣"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(r(!0),u(T,null,q(d.value,o=>(r(),u("tr",{key:o.id},[e("td",null,$(o.title),1),e("td",null,$(o.code),1),e("td",null,$(`${o.percent}%`),1),e("td",null,$(new Date(o.due_date).toLocaleDateString()),1),e("td",fe,[e("div",be,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!o.is_enabled},null,8,ve)])]),e("td",ge,[e("button",{type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2",onClick:s=>_(o)}," 編輯 ",8,ye),e("button",{type:"button",class:"btn btn-sm btn-outline-danger rounded-lg",onClick:s=>M(o.id)}," 刪除 ",8,_e)])]))),128))])])]))])]),R(ce,{ref:"couponModalRef",coupon:p.value,"function-mode":m.value,onGetCoupons:l},null,8,["coupon","function-mode"]),R(I,{ref:"couponDeleteModalRef",title:"刪除優惠券",content:"確定要刪除優惠券嗎？"},null,512)],64))}});export{Ce as default};
