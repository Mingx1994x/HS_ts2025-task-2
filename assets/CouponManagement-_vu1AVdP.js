import{a as R,d as A,r as c,o as M,c as B,u as P,b as N,e as i,f as r,g as e,m as F,F as S,n as I,i as p,v as b,j as q,t as v}from"./index-CSr7E_KC.js";import{M as z}from"./bootstrap.esm-C02OvDcj.js";function G(){return document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1")}const H="https://ec-course-api.hexschool.io/",m=R.create({baseURL:H});m.interceptors.request.use(s=>{const a=G();return a&&(s.headers.Authorization=a),s},s=>Promise.reject(s));m.interceptors.response.use(s=>s,s=>Promise.reject(s.response.data));const k="yameow2025",W=s=>m.post(`/v2/api/${k}/admin/coupon`,{data:s}),Y=s=>{const{id:a,data:f}=s;return m.put(`/v2/api/${k}/admin/coupon/${a}`,{data:f})},J=s=>m.get(`/v2/api/${k}/admin/coupons`,{params:s}),K={class:"d-flex justify-content-end align-items-center mb-4"},O={class:"card shadow-sm rounded-lg flex-grow-1"},Q={class:"card-body p-4"},X={key:0,class:"table-responsive"},Z={class:"table table-hover align-middle"},ee={class:"text-center"},te={class:"form-check form-switch d-flex justify-content-center align-items-center"},oe=["checked"],ne={class:"text-nowrap"},le=["onClick"],se={key:1,class:"d-flex justify-content-center align-items-center",style:{height:"calc(100vh - 98px)"}},ae={class:"modal-dialog modal-dialog-centered modal-lg"},de={class:"modal-content rounded-lg"},ie={class:"modal-body"},re={class:"mb-3"},ue={class:"mb-3"},ce={class:"mb-3"},pe={class:"mb-3"},me={class:"mb-3 d-flex align-items-center"},be={class:"form-check form-switch"},ve={class:"modal-footer"},ye=A({__name:"CouponManagement",setup(s){const a=c([]),f=c("1"),g=c(!1),x=async()=>{g.value=!0;try{const n=await J({page:f.value});console.log(n),a.value=n.data.coupons}catch(n){console.log(n),alert("取得優惠券失敗，請稍後再試")}finally{g.value=!1}},T=async()=>{try{const{id:n,title:t,is_enabled:o,percent:u,due_date:h,code:V}=l.value,j=await Y({id:n,data:{title:t,is_enabled:o,percent:u,due_date:h,code:V}});console.log(j)}catch(n){console.log(n),alert("更新優惠券失敗，請稍後再試")}};M(()=>{x()});const _=()=>({id:"",title:"",is_enabled:0,percent:0,due_date:new Date().getTime()+3600*24*1e3,code:"",num:0}),l=c(_()),C=B({get(){if(!l.value.due_date)return"";const n=new Date(l.value.due_date),t=n.getFullYear(),o=String(n.getMonth()+1).padStart(2,"0"),u=String(n.getDate()).padStart(2,"0");return`${t}-${o}-${u}`},set(n){if(!n){l.value.due_date=Date.now();return}const[t,o,u]=n.split("-").map(Number),h=new Date(t,o-1,u,0,0,0,0);l.value.due_date=h.getTime()}});let d=null;const y=P("modalRef"),L=()=>{d&&d.show()},U=()=>{d&&d.hide()};M(()=>{y.value&&(d=new z(y.value))}),N(()=>{d&&d.dispose()});const w=c("create"),D=(n=null)=>{n?(l.value=n,w.value="edit"):l.value=_(),L()},E=async n=>{try{const t=await W(n);console.log(t)}catch(t){console.log(t),alert("新增優惠券失敗，請稍後再試")}},$=async n=>{n==="create"?await E(l.value):await T(),U(),x()};return(n,t)=>(r(),i(S,null,[e("div",K,[e("button",{type:"button",class:"btn btn-dark rounded-lg px-4 py-2",onClick:t[0]||(t[0]=o=>D(null))},[...t[8]||(t[8]=[e("i",{class:"fas fa-plus me-2"},null,-1),F("新增優惠券 ",-1)])])]),e("div",O,[e("div",Q,[g.value?(r(),i("div",se,[...t[11]||(t[11]=[e("div",{class:"spinner-border",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)])])):(r(),i("div",X,[e("table",Z,[t[10]||(t[10]=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"優惠券碼"),e("th",{scope:"col"},"優惠折扣"),e("th",{scope:"col"},"到期日期"),e("th",{scope:"col",class:"text-center"},"啟用"),e("th",{scope:"col"})])],-1)),e("tbody",null,[(r(!0),i(S,null,I(a.value,o=>(r(),i("tr",{key:o.id},[e("td",null,v(o.title),1),e("td",null,v(o.code),1),e("td",null,v(`${o.percent}%`),1),e("td",null,v(new Date(o.due_date).toLocaleDateString()),1),e("td",ee,[e("div",te,[e("input",{readonly:"",class:"form-check-input",style:{"pointer-events":"none"},type:"checkbox",id:"flexSwitchCheckDefault1",checked:!!o.is_enabled},null,8,oe)])]),e("td",ne,[e("button",{type:"button",class:"btn btn-sm btn-outline-dark rounded-lg me-2",onClick:u=>D(o)}," 編輯 ",8,le),t[9]||(t[9]=e("button",{type:"button",class:"btn btn-sm btn-outline-danger rounded-lg"}," 刪除 ",-1))])]))),128))])])]))])]),e("div",{ref_key:"modalRef",ref:y,class:"modal fade",id:"couponModal",tabindex:"-1","aria-labelledby":"couponModalLabel","aria-hidden":"true"},[e("div",ae,[e("div",de,[t[18]||(t[18]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title",id:"couponModalLabel"},"新增優惠券"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ie,[e("form",null,[e("div",re,[t[12]||(t[12]=e("label",{for:"couponTitle",class:"form-label"},"優惠券標題",-1)),p(e("input",{type:"text",class:"form-control rounded-lg",id:"couponTitle",placeholder:"例如：新會員專屬折扣","onUpdate:modelValue":t[1]||(t[1]=o=>l.value.title=o)},null,512),[[b,l.value.title]])]),e("div",ue,[t[13]||(t[13]=e("label",{for:"couponCode",class:"form-label"},"優惠碼",-1)),p(e("input",{type:"text",class:"form-control rounded-lg",id:"couponCode",placeholder:"例如：NEW2024","onUpdate:modelValue":t[2]||(t[2]=o=>l.value.code=o)},null,512),[[b,l.value.code]])]),e("div",ce,[t[14]||(t[14]=e("label",{for:"couponDiscount",class:"form-label"},"折扣",-1)),p(e("input",{type:"number",max:"100",min:"0",class:"form-control rounded-lg",id:"couponDiscount",placeholder:"例如：90 代表 9 折","onUpdate:modelValue":t[3]||(t[3]=o=>l.value.percent=o)},null,512),[[b,l.value.percent]])]),e("div",pe,[t[15]||(t[15]=e("label",{for:"couponEndDate",class:"form-label"},"截止日",-1)),p(e("input",{type:"date",class:"form-control rounded-lg",id:"couponEndDate","onUpdate:modelValue":t[4]||(t[4]=o=>C.value=o)},null,512),[[b,C.value]])]),e("div",me,[t[16]||(t[16]=e("label",{class:"form-label me-3 mb-0"},"啟用",-1)),e("div",be,[p(e("input",{class:"form-check-input",type:"checkbox",id:"flexSwitchCouponEnable","onUpdate:modelValue":t[5]||(t[5]=o=>l.value.is_enabled=o),"true-value":1,"false-value":0},null,512),[[q,l.value.is_enabled]])])])])]),e("div",ve,[t[17]||(t[17]=e("button",{type:"button",class:"btn btn-outline-secondary rounded-lg","data-bs-dismiss":"modal"}," 取消 ",-1)),w.value==="create"?(r(),i("button",{key:0,type:"button",class:"btn btn-dark rounded-lg",onClick:t[6]||(t[6]=o=>$("create"))}," 新增 ")):(r(),i("button",{key:1,type:"button",class:"btn btn-dark rounded-lg",onClick:t[7]||(t[7]=o=>$("edit"))}," 儲存 "))])])])],512)],64))}});export{ye as default};
